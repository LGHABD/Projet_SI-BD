{% extends "layouts/base_dashboard.html" %}
{% block title %}Mes desiderata{% endblock %}
{% block topbar_subtitle %}Espace Etudiant{% endblock %}
{% block sidebar_content %}
  {% include "layouts/sidebar_student.html" %}
{% endblock %}
{% block sidebar_mobile %}
  {% include "layouts/sidebar_student.html" %}
{% endblock %}
{% block content %}
<div class="student-hero">
  <div>
    <h1>Mes desiderata</h1>
    <p>Choisissez vos etablissements (ordre de preference)</p>
  </div>
</div>

<div class="student-card">
  <div class="student-card-header">
    <h2>Statut</h2>
  </div>
  <div class="alert alert-info rounded-4 mb-0">
    Statut actuel: <strong>{{ desiderata.statut|default:"--" }}</strong>
    {% if desiderata.date_soumission %} - soumis le {{ desiderata.date_soumission }}{% endif %}
  </div>
  {% if not phase_open %}
    <div class="alert alert-warning rounded-4 mt-3 mb-0">
      La phase Desiderata est fermee. Les modifications sont desactivees.
    </div>
  {% endif %}
</div>

<div class="student-card">
  <div class="student-card-header">
    <h2>Choix disponibles</h2>
  </div>
  <form method="post">
    {% csrf_token %}

    <div class="row g-3">
      {% for place in places %}
        <div class="col-md-6">
          <div class="card-soft h-100">
            <div class="fw-semibold">{{ place.partenaire.nom }} - {{ place.type_mobilite }}</div>
            <div class="text-muted small">{{ place.filiere_partenaire }} | Places: {{ place.nombre_places }} | Flechee: {{ place.flechee }}</div>
            <div class="mt-2">
              <label class="form-label small">Rang (1..n)</label>
              <select class="form-select" name="place_rank_{{ forloop.counter }}" {% if not phase_open %}disabled{% endif %}>
                <option value="">(ne pas choisir)</option>
                <option value="{{ place.id }}">{{ place.id }} - Choisir</option>
              </select>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="empty-state">Aucune place disponible pour votre filiere.</div>
      {% endfor %}
    </div>

    <div class="mt-3 d-flex gap-2">
      <button class="btn btn-ensias" {% if not phase_open %}disabled{% endif %}>Soumettre</button>
      <a class="btn btn-outline-secondary" href="{% url 'home' %}">Retour</a>
    </div>
  </form>
</div>

<div class="student-card">
  <div class="student-card-header">
    <h2>Vos choix enregistres</h2>
  </div>
  <ul class="mb-0">
    {% for c in desiderata.choices.all %}
      <li>Rang {{ c.rank }} : {{ c.place.partenaire.nom }} ({{ c.place.type_mobilite }})</li>
    {% empty %}
      <li>Aucun choix.</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}

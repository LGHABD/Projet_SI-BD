{% extends "layouts/base_dashboard.html" %}
{% block title %}Tableau de bord{% endblock %}
{% block topbar_subtitle %}Espace Etudiant{% endblock %}
{% block sidebar_content %}
  {% include "layouts/sidebar_student.html" %}
{% endblock %}
{% block sidebar_mobile %}
  {% include "layouts/sidebar_student.html" %}
{% endblock %}

{% block content %}
  <div class="student-hero">
    <div>
      <h1>Bienvenue, {{ user.first_name|default:"Etudiant" }}</h1>
      <p>Suivez votre candidature pour la mobilite internationale ENSIAS</p>
    </div>
  </div>

  <div class="student-card">
    <div class="student-card-header">
      <h2>Progression de votre candidature</h2>
      {% if current_phase %}
        <span class="badge rounded-pill text-bg-primary">Phase actuelle : {{ current_phase.nom }}</span>
      {% endif %}
    </div>

    {% if phases %}
      <div class="phase-track">
        <div class="phase-line"></div>
        {% for p in phases %}
          <div class="phase-node {% if current_phase and p.ordre < current_phase.ordre %}done{% elif current_phase and p.id == current_phase.id %}active{% else %}todo{% endif %}">
            <div class="phase-dot">
              {% if current_phase and p.ordre < current_phase.ordre %}
                <i class="bi bi-check"></i>
              {% elif current_phase and p.id == current_phase.id %}
                <i class="bi bi-hourglass-split"></i>
              {% else %}
                <i class="bi bi-clock"></i>
              {% endif %}
            </div>
            <div class="phase-name">{{ p.nom }}</div>
            <div class="phase-date">
              {% if p.date_debut %}{{ p.date_debut|date:"d/m/Y" }}{% else %}--{% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">Aucune phase definie.</div>
    {% endif %}
  </div>

  <div class="kpi-row">
    <div class="kpi-slim">
      <div class="kpi-slim-left">
        <div class="kpi-slim-icon"><i class="bi bi-file-earmark-text"></i></div>
        <div>
          <div class="kpi-slim-title">Candidature</div>
          <div class="kpi-slim-sub">Statut global</div>
        </div>
      </div>
      <div class="kpi-slim-value">{% if candidature_status %}{{ candidature_status }}{% else %}--{% endif %}</div>
    </div>

    <div class="kpi-slim">
      <div class="kpi-slim-left">
        <div class="kpi-slim-icon"><i class="bi bi-geo-alt"></i></div>
        <div>
          <div class="kpi-slim-title">Desiderata</div>
          <div class="kpi-slim-sub">Ecoles selectionnees</div>
        </div>
      </div>
      <div class="kpi-slim-value">{{ nb_desiderata|default:0 }}</div>
    </div>

    <div class="kpi-slim">
      <div class="kpi-slim-left">
        <div class="kpi-slim-icon"><i class="bi bi-cloud-check"></i></div>
        <div>
          <div class="kpi-slim-title">Documents</div>
          <div class="kpi-slim-sub">Documents envoyes</div>
        </div>
      </div>
      <div class="kpi-slim-value">{{ docs_done|default:0 }}/{{ docs_required|default:0 }}</div>
    </div>
  </div>

  <div class="student-card">
    <div class="student-card-header">
      <h2>Actions rapides</h2>
    </div>
    <div class="quick-actions">
      <a class="qa" href="{% url 'student_candidature' %}"><i class="bi bi-person-vcard"></i><span>Mon profil</span></a>
      <a class="qa" href="{% url 'student_desiderata' %}"><i class="bi bi-list-check"></i><span>Mes choix</span></a>
      <a class="qa" href="{% url 'student_documents' %}"><i class="bi bi-cloud-upload"></i><span>Mes documents</span></a>
      <a class="qa" href="{% url 'student_messages' %}"><i class="bi bi-chat-dots"></i><span>Messages</span></a>
    </div>
  </div>
{% endblock %}
